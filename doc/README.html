<!DOCTYPE html>
<!-- saved from url=(0028)http://localhost:8081/export -->
<html lang="zh"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <title>HTML Preview - Editor.md</title>
        <link rel="stylesheet" href="./README_files/style.css">
        <link rel="stylesheet" href="./README_files/editormd.preview.css">
        <link rel="shortcut icon" href="https://pandao.github.io/editor.md/favicon.ico" type="image/x-icon">
        <style>            
            .editormd-html-preview {
                width: 90%;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <div id="layout">
           
            <div id="test-editormd-view" class="markdown-body editormd-html-preview">
                              
            <h1 id="h1-redis-pub-sub"><a name="Redis Pub-Sub" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Redis Pub-Sub</h1><h3 id="h3-set-up-redis-server"><a name="Set up Redis server" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Set up Redis server</h3><ol>
<li>Creating the Redis Deployment (<strong>redis-deployment.yaml</strong>)<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-yaml"><span class="pln">apiVersion</span><span class="pun">:</span><span class="pln"> apps</span><span class="pun">/</span><span class="pln">v1</span></code></li><li class="L1"><code class="lang-yaml"><span class="pln">kind</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Deployment</span></code></li><li class="L2"><code class="lang-yaml"><span class="pln">metadata</span><span class="pun">:</span></code></li><li class="L3"><code class="lang-yaml"><span class="pln">name</span><span class="pun">:</span><span class="pln"> redis</span></code></li><li class="L4"><code class="lang-yaml"><span class="pln">labels</span><span class="pun">:</span></code></li><li class="L5"><code class="lang-yaml"><span class="pln"> app</span><span class="pun">:</span><span class="pln"> redis</span></code></li><li class="L6"><code class="lang-yaml"><span class="pln">spec</span><span class="pun">:</span></code></li><li class="L7"><code class="lang-yaml"><span class="pln">selector</span><span class="pun">:</span></code></li><li class="L8"><code class="lang-yaml"><span class="pln"> matchLabels</span><span class="pun">:</span></code></li><li class="L9"><code class="lang-yaml"><span class="pln">   app</span><span class="pun">:</span><span class="pln"> redis</span></code></li><li class="L0"><code class="lang-yaml"><span class="pln">replicas</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span></code></li><li class="L1"><code class="lang-yaml"><span class="kwd">template</span><span class="pun">:</span></code></li><li class="L2"><code class="lang-yaml"><span class="pln"> metadata</span><span class="pun">:</span></code></li><li class="L3"><code class="lang-yaml"><span class="pln">   labels</span><span class="pun">:</span></code></li><li class="L4"><code class="lang-yaml"><span class="pln">     app</span><span class="pun">:</span><span class="pln"> redis</span></code></li><li class="L5"><code class="lang-yaml"><span class="pln"> spec</span><span class="pun">:</span></code></li><li class="L6"><code class="lang-yaml"><span class="pln">   containers</span><span class="pun">:</span></code></li><li class="L7"><code class="lang-yaml"><span class="pln">   </span><span class="pun">-</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> redis</span></code></li><li class="L8"><code class="lang-yaml"><span class="pln">     image</span><span class="pun">:</span><span class="pln"> redis</span><span class="pun">:</span><span class="lit">4</span></code></li><li class="L9"><code class="lang-yaml"><span class="pln">     ports</span><span class="pun">:</span></code></li><li class="L0"><code class="lang-yaml"><span class="pln">     </span><span class="pun">-</span><span class="pln"> containerPort</span><span class="pun">:</span><span class="pln"> </span><span class="lit">6379</span></code></li></ol></pre>
</li><li>Run Redis as instances<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-shell"><span class="pln">kubectl apply </span><span class="pun">-</span><span class="pln">f redis</span><span class="pun">-</span><span class="pln">deployment</span><span class="pun">.</span><span class="pln">yaml</span></code></li></ol></pre>
</li><li>Create the Redis Service (<strong>redis-service.yaml</strong>)<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-yaml"><span class="pln">apiVersion</span><span class="pun">:</span><span class="pln"> v1</span></code></li><li class="L1"><code class="lang-yaml"><span class="pln">kind</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Service</span></code></li><li class="L2"><code class="lang-yaml"><span class="pln">metadata</span><span class="pun">:</span></code></li><li class="L3"><code class="lang-yaml"><span class="pln">name</span><span class="pun">:</span><span class="pln"> redis</span></code></li><li class="L4"><code class="lang-yaml"><span class="pln">labels</span><span class="pun">:</span></code></li><li class="L5"><code class="lang-yaml"><span class="pln"> app</span><span class="pun">:</span><span class="pln"> redis</span></code></li><li class="L6"><code class="lang-yaml"><span class="pln">spec</span><span class="pun">:</span></code></li><li class="L7"><code class="lang-yaml"><span class="pln">ports</span><span class="pun">:</span></code></li><li class="L8"><code class="lang-yaml"><span class="pun">-</span><span class="pln"> port</span><span class="pun">:</span><span class="pln"> </span><span class="lit">6379</span></code></li><li class="L9"><code class="lang-yaml"><span class="pln"> targetPort</span><span class="pun">:</span><span class="pln"> </span><span class="lit">6379</span></code></li><li class="L0"><code class="lang-yaml"><span class="pln">selector</span><span class="pun">:</span></code></li><li class="L1"><code class="lang-yaml"><span class="pln"> app</span><span class="pun">:</span><span class="pln"> redis</span></code></li></ol></pre>
</li><li>Publish Redis instances as service<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-shell"><span class="pln">kubectl apply </span><span class="pun">-</span><span class="pln">f redis</span><span class="pun">-</span><span class="pln">service</span><span class="pun">.</span><span class="pln">yaml</span></code></li></ol></pre>
</li><li>Check service running<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-shell"><span class="pln">kubectl </span><span class="kwd">get</span><span class="pln"> pods</span></code></li><li class="L1"><code class="lang-shell"><span class="pln">redis</span><span class="pun">-</span><span class="lit">76d55d8d56</span><span class="pun">-</span><span class="pln">mhw67            </span><span class="lit">1</span><span class="pun">/</span><span class="lit">1</span><span class="pln">       </span><span class="typ">Running</span><span class="pln">   </span><span class="lit">0</span><span class="pln">          </span><span class="lit">26m</span></code></li></ol></pre>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-shell"><span class="pln">kubectl </span><span class="kwd">get</span><span class="pln"> services</span></code></li><li class="L1"><code class="lang-shell"><span class="pln">redis             </span><span class="typ">ClusterIP</span><span class="pln">      </span><span class="lit">10.19</span><span class="pun">.</span><span class="lit">248.150</span><span class="pln">   </span><span class="str">&lt;none&gt;</span><span class="pln">          </span><span class="lit">6379</span><span class="pun">/</span><span class="pln">TCP       </span><span class="lit">3s</span></code></li></ol></pre>
</li></ol>
<h3 id="h3-set-up-publisher"><a name="Set up Publisher" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Set up Publisher</h3><ol>
<li>Create Spring Boot project with Jedis dependency<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-xml"><span class="tag">&lt;dependency&gt;</span></code></li><li class="L1"><code class="lang-xml"><span class="pln"> </span><span class="tag">&lt;groupId&gt;</span><span class="pln">redis.clients</span><span class="tag">&lt;/groupId&gt;</span></code></li><li class="L2"><code class="lang-xml"><span class="pln"> </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">jedis</span><span class="tag">&lt;/artifactId&gt;</span></code></li><li class="L3"><code class="lang-xml"><span class="tag">&lt;/dependency&gt;</span></code></li></ol></pre>
</li><li><p>Create Publisher class</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"></code></li><li class="L2"><code class="lang-java"><span class="pln"> </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Jedis</span><span class="pln"> publisherJedis</span><span class="pun">;</span></code></li><li class="L3"><code class="lang-java"><span class="pln"> </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> channel</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-java"></code></li><li class="L5"><code class="lang-java"><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pun">(</span><span class="typ">Jedis</span><span class="pln"> publisherJedis</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> channel</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="lang-java"><span class="pln">     </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">publisherJedis </span><span class="pun">=</span><span class="pln"> publisherJedis</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-java"><span class="pln">     </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">channel </span><span class="pun">=</span><span class="pln"> channel</span><span class="pun">;</span></code></li><li class="L8"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li><li class="L9"><code class="lang-java"></code></li><li class="L0"><code class="lang-java"><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> publish</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"><span class="pln">     publisherJedis</span><span class="pun">.</span><span class="pln">publish</span><span class="pun">(</span><span class="pln">channel</span><span class="pun">,</span><span class="pln"> message</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li><li class="L3"><code class="lang-java"><span class="pun">}</span></code></li></ol></pre>
</li><li><p>Create Bean for Publisher</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Bean" title="@Bean" class="at-link"><span class="lit">@Bean</span></a></code></li><li class="L1"><code class="lang-java"><span class="pln"> </span><span class="typ">Jedis</span><span class="pln"> getRedisClient</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-java"><span class="pln">     </span><span class="typ">Jedis</span><span class="pln"> jedis </span><span class="pun">=</span><span class="pln"> getJedisPool</span><span class="pun">().</span><span class="pln">getResource</span><span class="pun">();</span></code></li><li class="L3"><code class="lang-java"><span class="pln">     </span><span class="kwd">return</span><span class="pln"> jedis</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li><li class="L5"><code class="lang-java"></code></li><li class="L6"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Bean" title="@Bean" class="at-link"><span class="lit">@Bean</span></a></code></li><li class="L7"><code class="lang-java"><span class="pln"> </span><span class="typ">JedisPool</span><span class="pln"> getJedisPool</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="lang-java"><span class="pln">     </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">JedisPoolConfig</span><span class="pln"> poolConfig </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JedisPoolConfig</span><span class="pun">();</span></code></li><li class="L9"><code class="lang-java"><span class="pln">     </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">JedisPool</span><span class="pln"> jedisPool </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JedisPool</span><span class="pun">(</span><span class="pln">poolConfig</span><span class="pun">,</span><span class="pln"> redisHost</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">parseInt</span><span class="pun">(</span><span class="pln">redisPort</span><span class="pun">),</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L0"><code class="lang-java"><span class="pln">     </span><span class="kwd">return</span><span class="pln"> jedisPool</span><span class="pun">;</span></code></li><li class="L1"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li><li class="L2"><code class="lang-java"></code></li><li class="L3"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Bean" title="@Bean" class="at-link"><span class="lit">@Bean</span></a></code></li><li class="L4"><code class="lang-java"><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> getPublisher</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-java"><span class="pln">     </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Publisher</span><span class="pun">(</span><span class="pln">getRedisClient</span><span class="pun">(),</span><span class="pln"> redisChannel</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li></ol></pre>
</li><li><p>Publish messages with Publisher</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ContractController</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"></code></li><li class="L2"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Autowired" title="@Autowired" class="at-link"><span class="lit">@Autowired</span></a></code></li><li class="L3"><code class="lang-java"><span class="pln"> </span><span class="typ">Publisher</span><span class="pln"> publisher</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-java"></code></li><li class="L5"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Autowired" title="@Autowired" class="at-link"><span class="lit">@Autowired</span></a></code></li><li class="L6"><code class="lang-java"><span class="pln"> </span><span class="typ">ContractRepo</span><span class="pln"> contractRepo</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-java"></code></li><li class="L8"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/PostMapping" title="@PostMapping" class="at-link"><span class="lit">@PostMapping</span></a><span class="pun">(</span><span class="str">"/add"</span><span class="pun">)</span></code></li><li class="L9"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/ResponseBody" title="@ResponseBody" class="at-link"><span class="lit">@ResponseBody</span></a></code></li><li class="L0"><code class="lang-java"><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">ResponseEntity</span><span class="pun">&lt;?&gt;</span><span class="pln"> addContract</span><span class="pun">(</span><a href="https://github.com/RequestParam" title="@RequestParam" class="at-link"><span class="lit">@RequestParam</span></a><span class="pun">(</span><span class="str">"name"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><a href="https://github.com/RequestParam" title="@RequestParam" class="at-link"><span class="lit">@RequestParam</span></a><span class="pun">(</span><span class="str">"type"</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> type</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"><span class="pln">     </span><span class="typ">Contract</span><span class="pln"> contract </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Contract</span><span class="pun">();</span></code></li><li class="L2"><code class="lang-java"><span class="pln">     contract</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="pln">name</span><span class="pun">);</span></code></li><li class="L3"><code class="lang-java"><span class="pln">     contract</span><span class="pun">.</span><span class="pln">setType</span><span class="pun">(</span><span class="pln">type</span><span class="pun">);</span></code></li><li class="L4"><code class="lang-java"><span class="pln">     </span><span class="typ">Contract</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> contractRepo</span><span class="pun">.</span><span class="pln">save</span><span class="pun">(</span><span class="pln">contract</span><span class="pun">);</span></code></li><li class="L5"><code class="lang-java"><span class="pln">     publisher</span><span class="pun">.</span><span class="pln">publish</span><span class="pun">(</span><span class="str">"There is a new contract has been added!"</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-java"><span class="pln">     </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ResponseEntity</span><span class="pun">&lt;&gt;(</span><span class="pln">data</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HttpStatus</span><span class="pun">.</span><span class="pln">OK</span><span class="pun">);</span></code></li><li class="L7"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-java"><span class="pun">}</span></code></li></ol></pre>
</li></ol>
<h3 id="h3-set-up-subscriber"><a name="Set up Subscriber" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Set up Subscriber</h3><ol>
<li>Create Spring Boot project with Jedis dependency<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-xml"><span class="tag">&lt;dependency&gt;</span></code></li><li class="L1"><code class="lang-xml"><span class="pln"> </span><span class="tag">&lt;groupId&gt;</span><span class="pln">redis.clients</span><span class="tag">&lt;/groupId&gt;</span></code></li><li class="L2"><code class="lang-xml"><span class="pln"> </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">jedis</span><span class="tag">&lt;/artifactId&gt;</span></code></li><li class="L3"><code class="lang-xml"><span class="tag">&lt;/dependency&gt;</span></code></li></ol></pre>
</li><li><p>Create SubscriberHandler class</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SubscriberHandler</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">JedisPubSub</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"></code></li><li class="L2"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Override" title="@Override" class="at-link"><span class="lit">@Override</span></a></code></li><li class="L3"><code class="lang-java"><span class="pln">     </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onMessage</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> channel</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="lang-java"><span class="pln">         </span><span class="typ">System</span><span class="pun">.</span><span class="pln">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"channel: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> channel </span><span class="pun">+</span><span class="pln"> </span><span class="str">", message: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> message</span><span class="pun">);</span></code></li><li class="L5"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L6"><code class="lang-java"></code></li><li class="L7"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Override" title="@Override" class="at-link"><span class="lit">@Override</span></a></code></li><li class="L8"><code class="lang-java"><span class="pln">     </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onPMessage</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> pattern</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> channel</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L0"><code class="lang-java"></code></li><li class="L1"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Override" title="@Override" class="at-link"><span class="lit">@Override</span></a></code></li><li class="L2"><code class="lang-java"><span class="pln">     </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onSubscribe</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> channel</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> subscribedChannels</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L4"><code class="lang-java"></code></li><li class="L5"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Override" title="@Override" class="at-link"><span class="lit">@Override</span></a></code></li><li class="L6"><code class="lang-java"><span class="pln">     </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onUnsubscribe</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> channel</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> subscribedChannels</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-java"></code></li><li class="L9"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Override" title="@Override" class="at-link"><span class="lit">@Override</span></a></code></li><li class="L0"><code class="lang-java"><span class="pln">     </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onPUnsubscribe</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> pattern</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> subscribedChannels</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L2"><code class="lang-java"></code></li><li class="L3"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Override" title="@Override" class="at-link"><span class="lit">@Override</span></a></code></li><li class="L4"><code class="lang-java"><span class="pln">     </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onPSubscribe</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> pattern</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> subscribedChannels</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L6"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li></ol></pre>
</li><li><p>Create SubscriberListener class</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Component" title="@Component" class="at-link"><span class="lit">@Component</span></a></code></li><li class="L1"><code class="lang-java"><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SubscriberListener</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DisposableBean</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Runnable</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-java"><span class="pln">     </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Thread</span><span class="pln"> THREAD</span><span class="pun">;</span></code></li><li class="L3"><code class="lang-java"><span class="pln">     </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isRunning </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-java"></code></li><li class="L5"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Autowired" title="@Autowired" class="at-link"><span class="lit">@Autowired</span></a></code></li><li class="L6"><code class="lang-java"><span class="pln">     </span><span class="typ">Jedis</span><span class="pln"> jedis</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-java"></code></li><li class="L8"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Autowired" title="@Autowired" class="at-link"><span class="lit">@Autowired</span></a></code></li><li class="L9"><code class="lang-java"><span class="pln">     </span><span class="typ">SubscriberHandler</span><span class="pln"> handler</span><span class="pun">;</span></code></li><li class="L0"><code class="lang-java"></code></li><li class="L1"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Value" title="@Value" class="at-link"><span class="lit">@Value</span></a><span class="pun">(</span><span class="str">"${redis.channel}"</span><span class="pun">)</span></code></li><li class="L2"><code class="lang-java"><span class="pln">     </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> redisChannel</span><span class="pun">;</span></code></li><li class="L3"><code class="lang-java"></code></li><li class="L4"><code class="lang-java"><span class="pln">     </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">SubscriberListener</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-java"><span class="pln">         </span><span class="typ">Thread</span><span class="pln"> thread </span><span class="pun">=</span><span class="pln"> getThreadByName</span><span class="pun">(</span><span class="str">"Subscriber"</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-java"><span class="pln">         </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">thread </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="lang-java"><span class="pln">             THREAD </span><span class="pun">=</span><span class="pln"> thread</span><span class="pun">;</span></code></li><li class="L8"><code class="lang-java"><span class="pln">         </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="lang-java"><span class="pln">             THREAD </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></code></li><li class="L0"><code class="lang-java"><span class="pln">             THREAD</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="str">"Subscriber"</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-java"><span class="pln">         </span><span class="pun">}</span></code></li><li class="L2"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L3"><code class="lang-java"></code></li><li class="L4"><code class="lang-java"><span class="pln">     </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Thread</span><span class="pln"> getThreadByName</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> threadName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-java"><span class="pln">         </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Thread</span><span class="pln"> t </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">getAllStackTraces</span><span class="pun">().</span><span class="pln">keySet</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="lang-java"><span class="pln">             </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">().</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">threadName</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="lang-java"><span class="pln">                 </span><span class="kwd">return</span><span class="pln"> t</span><span class="pun">;</span></code></li><li class="L8"><code class="lang-java"><span class="pln">             </span><span class="pun">}</span></code></li><li class="L9"><code class="lang-java"><span class="pln">         </span><span class="pun">}</span></code></li><li class="L0"><code class="lang-java"><span class="pln">         </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L1"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L2"><code class="lang-java"></code></li><li class="L3"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Override" title="@Override" class="at-link"><span class="lit">@Override</span></a></code></li><li class="L4"><code class="lang-java"><span class="pln">     </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-java"><span class="pln">         </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isRunning</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="lang-java"><span class="pln">             </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="lang-java"><span class="pln">                 </span><span class="typ">System</span><span class="pun">.</span><span class="pln">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"Subscriber listener started."</span><span class="pun">);</span></code></li><li class="L8"><code class="lang-java"><span class="pln">                 jedis</span><span class="pun">.</span><span class="pln">subscribe</span><span class="pun">(</span><span class="pln">handler</span><span class="pun">,</span><span class="pln"> redisChannel</span><span class="pun">);</span></code></li><li class="L9"><code class="lang-java"><span class="pln">                 </span><span class="typ">System</span><span class="pun">.</span><span class="pln">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"Subscriber listener ended."</span><span class="pun">);</span></code></li><li class="L0"><code class="lang-java"><span class="pln">             </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Exception</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"><span class="pln">                 </span><span class="typ">System</span><span class="pun">.</span><span class="pln">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"Subscriber listener failed."</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-java"><span class="pln">                 e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span></code></li><li class="L3"><code class="lang-java"><span class="pln">             </span><span class="pun">}</span></code></li><li class="L4"><code class="lang-java"><span class="pln">         </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-java"><span class="pln">             </span><span class="typ">System</span><span class="pun">.</span><span class="pln">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"Subscriber listener stopped."</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-java"><span class="pln">         </span><span class="pun">}</span></code></li><li class="L7"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-java"></code></li><li class="L9"><code class="lang-java"><span class="pln">     </span><a href="https://github.com/Override" title="@Override" class="at-link"><span class="lit">@Override</span></a></code></li><li class="L0"><code class="lang-java"><span class="pln">     </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> destroy</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"><span class="pln">         isRunning </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L2"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L3"><code class="lang-java"></code></li><li class="L4"><code class="lang-java"><span class="pln">     </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> start</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-java"><span class="pln">         </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">THREAD</span><span class="pun">.</span><span class="pln">isAlive</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="lang-java"><span class="pln">             THREAD</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span></code></li><li class="L7"><code class="lang-java"><span class="pln">         </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-java"><span class="pln">         isRunning </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L9"><code class="lang-java"><span class="pln">     </span><span class="pun">}</span></code></li><li class="L0"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li></ol></pre>
</li><li><p>Create Bean for SubscriberHandler</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Bean" title="@Bean" class="at-link"><span class="lit">@Bean</span></a></code></li><li class="L1"><code class="lang-java"><span class="pln"> </span><span class="typ">Jedis</span><span class="pln"> getRedisClient</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-java"><span class="pln">     </span><span class="typ">Jedis</span><span class="pln"> jedis </span><span class="pun">=</span><span class="pln"> getJedisPool</span><span class="pun">().</span><span class="pln">getResource</span><span class="pun">();</span></code></li><li class="L3"><code class="lang-java"><span class="pln">     </span><span class="kwd">return</span><span class="pln"> jedis</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li><li class="L5"><code class="lang-java"></code></li><li class="L6"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Bean" title="@Bean" class="at-link"><span class="lit">@Bean</span></a></code></li><li class="L7"><code class="lang-java"><span class="pln"> </span><span class="typ">JedisPool</span><span class="pln"> getJedisPool</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="lang-java"><span class="pln">     </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">JedisPoolConfig</span><span class="pln"> poolConfig </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JedisPoolConfig</span><span class="pun">();</span></code></li><li class="L9"><code class="lang-java"><span class="pln">     </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">JedisPool</span><span class="pln"> jedisPool </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JedisPool</span><span class="pun">(</span><span class="pln">poolConfig</span><span class="pun">,</span><span class="pln"> redisHost</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">parseInt</span><span class="pun">(</span><span class="pln">redisPort</span><span class="pun">),</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></code></li><li class="L0"><code class="lang-java"><span class="pln">     </span><span class="kwd">return</span><span class="pln"> jedisPool</span><span class="pun">;</span></code></li><li class="L1"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li><li class="L2"><code class="lang-java"></code></li><li class="L3"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Bean" title="@Bean" class="at-link"><span class="lit">@Bean</span></a></code></li><li class="L4"><code class="lang-java"><span class="pln"> </span><span class="typ">SubscriberHandler</span><span class="pln"> getSubscriberHandler</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-java"><span class="pln">     </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SubscriberHandler</span><span class="pun">();</span></code></li><li class="L6"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li></ol></pre>
</li><li><p>Start SubscriberListener</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Autowired" title="@Autowired" class="at-link"><span class="lit">@Autowired</span></a></code></li><li class="L1"><code class="lang-java"><span class="pln"> </span><span class="typ">SubscriberListener</span><span class="pln"> listener</span><span class="pun">;</span></code></li><li class="L2"><code class="lang-java"></code></li><li class="L3"><code class="lang-java"><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="lang-java"><span class="pln">     </span><span class="typ">SpringApplication</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="typ">Application</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">);</span></code></li><li class="L5"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li><li class="L6"><code class="lang-java"></code></li><li class="L7"><code class="lang-java"><span class="pln"> </span><a href="https://github.com/Bean" title="@Bean" class="at-link"><span class="lit">@Bean</span></a></code></li><li class="L8"><code class="lang-java"><span class="pln"> </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">CommandLineRunner</span><span class="pln"> commandLineRunner</span><span class="pun">(</span><span class="pln">org</span><span class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">context</span><span class="pun">.</span><span class="typ">ApplicationContext</span><span class="pln"> ctx</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="lang-java"><span class="pln">     </span><span class="kwd">return</span><span class="pln"> args </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="lang-java"><span class="pln">         listener</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span></code></li><li class="L1"><code class="lang-java"><span class="pln">     </span><span class="pun">};</span></code></li><li class="L2"><code class="lang-java"><span class="pln"> </span><span class="pun">}</span></code></li></ol></pre>
</li></ol>
<h3 id="h3-test-result"><a name="Test result" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Test result</h3><ol>
<li>Create new contract on publis<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-shell"><span class="pln">curl </span><span class="pun">-</span><span class="pln">X POST http</span><span class="pun">:</span><span class="com">//localhost:8080/add  -d "name=new contract&amp;type=1"</span></code></li></ol></pre>
</li><li>Check output in subscriber console<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-shell"><span class="typ">Subscriber</span><span class="pln"> listener started</span><span class="pun">.</span></code></li><li class="L1"><code class="lang-shell"><span class="pln">channel</span><span class="pun">:</span><span class="pln"> test</span><span class="pun">-</span><span class="pln">channel</span><span class="pun">,</span><span class="pln"> message</span><span class="pun">:</span><span class="pln"> </span><span class="typ">There</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> a </span><span class="kwd">new</span><span class="pln"> contract has been added</span><span class="pun">!</span></code></li></ol></pre>
</li></ol>
</div>
            
        </div>
  
        <script src="./README_files/jquery.min.js.download"></script>
        <script src="./README_files/marked.min.js.download"></script>
        <script src="./README_files/prettify.min.js.download"></script>
        
        <script src="./README_files/raphael.min.js.download"></script>
        <script src="./README_files/underscore.min.js.download"></script>
        <script src="./README_files/sequence-diagram.min.js.download"></script>
        <script src="./README_files/flowchart.min.js.download"></script>
        <script src="./README_files/jquery.flowchart.min.js.download"></script>

        <script src="./README_files/editormd.js.download"></script>
        <script type="text/javascript">
            $(function() {
				var markdown = localStorage.getItem('md');
				if(markdown){
					editormd.markdownToHTML("test-editormd-view", {
                        markdown        : markdown
                    });
				}  
               
            });
        </script>
    
</body></html>